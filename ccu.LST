C51 COMPILER V8.12   CCU                                                                   12/20/2010 04:50:05 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE CCU
OBJECT MODULE PLACED IN ccu.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ccu.c ROM(COMPACT) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /***********************************************************************
   2          MODULE:    CAPTURE COMPARE UNIT
   3          VERSION:   1.02
   4          CONTAINS:  Routines for configuring the Capture Compare Unit on the
   5                     P89LPC936
   6          COPYRIGHT: Embedded Systems Academy, Inc. - www.esacademy.com
   7          LICENSE:   May be freely used in commercial and non-commercial code
   8                     without royalties provided this copyright notice remains
   9                     in this file and unaltered
  10          WARNING:   IF THIS FILE IS REGENERATED BY CODE ARCHITECT ANY CHANGES
  11                     MADE WILL BE LOST. WHERE POSSIBLE USE ONLY CODE ARCHITECT
  12                     TO CHANGE THE CONTENTS OF THIS FILE
  13          GENERATED: On "Nov 17 2010" at "02:35:06" by Code Architect 2.06
  14          ***********************************************************************/
  15          
  16          // SFR description needs to be included
  17          #include <reg936.h>
  18          #include "iTrip.h"
  19          #include "ccu.h"
  20          
  21          extern volatile word timerCapture;
  22          extern volatile bit DC;
  23          
  24          /***********************************************************************
  25          DESC:    Initializes the Capture Compare Unit
  26                   basic timer, count up
  27                   Period: 4 secs
  28          RETURNS: Nothing
  29          CAUTION: Set EA to 1 after calling to enable interrupts
  30          ************************************************************************/
  31          void ccu_init
  32            (
  33            void
  34            )
  35          {
  36   1              //Channel A for comparator time out
  37   1              CCCRA = 0x01;
  38   1          OCRAH = CCU_DC >> 8;
*** ERROR C202 IN LINE 38 OF CCU.C: 'CCU_DC': undefined identifier
  39   1          OCRAL = CCU_DC;
*** ERROR C202 IN LINE 39 OF CCU.C: 'CCU_DC': undefined identifier
  40   1      
  41   1              //channels disabled
  42   1              CCCRB = 0x00;
  43   1              CCCRC = 0x00;
  44   1              CCCRD = 0x00;
  45   1              
  46   1              // reload value (up counter)
  47   1              TOR2H = 0x00;
  48   1              TOR2L = 0x00;
  49   1              
  50   1              // latch shadow registers on next overflow
  51   1              TCR21 |= 0x80;
  52   1              
  53   1              // initial count
C51 COMPILER V8.12   CCU                                                                   12/20/2010 04:50:05 PAGE 2   

  54   1              TH2 = 0x00;
  55   1              TL2 = 0x00;
  56   1              
  57   1              // timer prescaler
  58   1              // divides CCUCLK by 225, CLK^-1 = 61.035 us, CLK^-1 * 2^16 = 3.99999
  59   1              TPCR2H = 0x00;
  60   1              TPCR2L = 0xE1;
  61   1                
  62   1              // set interrupt priority to 0
  63   1              IP1 &= ~0x10;
  64   1              IP1H &= ~0x10;
  65   1      
  66   1              //Configure and enable overflow and Channel A interrupts
  67   1      //      TICR2 |= 0x88;
  68   1      //      ECCU = 1;
  69   1              // basic timer, count up
  70   1              TCR20 = 0x00;
  71   1      }
  72          
  73          void start_CCU () {
  74   1              // count on     
  75   1              TCR20 = 0x01;
  76   1      }
  77          
  78          void stop_CCU () {
  79   1              //count off
  80   1              TCR20 = 0x00;
  81   1      }
  82          
  83          void ccu_isr
  84            (
  85            void
  86            ) interrupt 11 using 3
  87          {
  88   1              //Clear interrupt flag
  89   1              TIFR2 &= ~0x88;
  90   1      //      ++timerCapture;
  91   1      //      DC = 1;
  92   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  2 ERROR(S)
